<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<title>后台管理系统</title>
<meta name="author" content="DeathGhost" />
<link rel="stylesheet" type="text/css" href="css/content.css" />
<!--[if lt IE 9]>
<script src="js/html5.js"></script>
<![endif]-->
<script src="js/jquery.js"></script>
<script src="../src/lib/jquery/jquery.form.js"></script>
<script src="../src/lib/common/global.js"></script>
<script src="js/jquery.mCustomScrollbar.concat.min.js"></script>
<script>
	(function($){
		$(window).load(function(){
			
			$("a[rel='load-content']").click(function(e){
				e.preventDefault();
				var url=$(this).attr("href");
				$.get(url,function(data){
					$(".content .mCSB_container").append(data); //load new content inside .mCSB_container
					//scroll-to appended content 
					$(".content").mCustomScrollbar("scrollTo","h2:last");
				});
			});
			
			$(".content").delegate("a[href='top']","click",function(e){
				e.preventDefault();
				$(".content").mCustomScrollbar("scrollTo",$(this).attr("href"));
			});
			
		});
	})(jQuery);
</script>
</head>
<body>
  <!--header-->
  <header>
   <h1>Sweetcake 后台管理</h1>
   <ul class="rt_nav">
    <li><a href="http://www.baidu.com" target="_blank" class="website_icon">站点首页</a></li>
    <li><a href="#" class="admin_icon">DeathGhost</a></li>
    <li><a href="#" class="set_icon">账号设置</a></li>
    <li><a href="login.php" class="quit_icon">安全退出</a></li>
   </ul>
  </header>

  <!--aside nav-->
  <aside class="lt_aside_nav content mCustomScrollbar">
   <h2><a href="index.php">起始页</a></h2>
   <ul>
    <li>
     <dl>
      <dt>商品信息</dt>
      <!--当前链接则添加class:active-->
      <dd><a href="#" class="active">商品列表</a></dd>
      <dd><a href="#">商品分类</a></dd>
      <dd><a href="#">商品属性</a></dd>
      <dd><a href="#">品牌管理</a></dd>
     </dl>
    </li>
    <li>
     <dl>
      <dt>订单信息</dt>
      <dd><a href="#">订单列表</a></dd>
      <dd><a href="#">订单查询</a></dd>
      <!-- <dd><a href="#">缺货登记</a></dd> -->
     </dl>
    </li>
    <li>
     <dl>
      <dt>会员管理</dt>
      <dd><a href="#">会员列表</a></dd>
      <dd><a href="#">添加会员</a></dd>
      <dd><a href="#">会员等级</a></dd>
      <!-- <dd><a href="#">资金管理</a></dd> -->
     </dl>
    </li>
    <li>
     <dl>
      <dt>基础设置</dt>
      <dd><a href="#">站点基础设置</a></dd>
      <dd><a href="#">SEO设置</a></dd>
      <dd><a href="#">SQL语句查询</a></dd>
      <dd><a href="#">模板管理</a></dd>
     </dl>
    </li>
    <li>
     <dl>
      <dt>营销管理</dt>
      <dd><a href="#">订阅列表</a></dd>
      <dd><a href="#">邮件群发</a></dd>
      <dd><a href="#">优惠打折</a></dd>
     </dl>
    </li>
    <li>
     <dl>
      <dt>配送与支付设置</dt>
      <dd><a href="#">配送方式</a></dd>
      <dd><a href="#">支付方式</a></dd>
     </dl>
    </li>
    <li>
     <dl>
      <dt>在线统计</dt>
      <dd><a href="#">流量统计</a></dd>
      <dd><a href="#">销售额统计</a></dd>
     </dl>
    </li>
    <li>
     <p class="btm_infor">© Sweetcake 版权所有</p>
    </li>
   </ul>
  </aside>
  <!-- section 商品列表 -->
  <section class="box" >
    <div class="contop">
        <h4>商品查询/添加</h4>
        <div class="searchbox">
          <p class="tip">输入商品ID查询</p><span><input type="text" class="see_id"></span> <button class="search_btn">点击搜索</button>
          <span class="search_err" style="color:#dbac72;"></span>
        </div>
        <div class="contop_r">
          <button class="add_btn">添加商品</button>
        </div>
        <section class="addprodut" >
          <h2><strong style="color:grey;">商品添加内容布局</strong><button class="close_add">x</button></h2>
          <ul class="ulColumn2">
           <li>
            <span class="item_name " style="width:120px;">商品名称：</span>
            <input type="text" class="textbox textbox_295 produt_name" placeholder="商品名称"/>
           </li>
           <li>
            <span class="item_name" style="width:120px;">商品ID：</span>
            <input type="text" class="textbox textbox_295 produt_id" placeholder="商品ID"/><span class="id_title" style="color:#dbac72;"></span>
            <!-- <span class="errorTips">错误提示信息...</span> -->
           </li>
           <li>
            <span class="item_name" style="width:120px;">Drand：</span>
            <input type="text" class="textbox textbox_295 produt_brand" placeholder="商品英文名"/>
           </li>
           <li>
            <span class="item_name" style="width:120px;">商品信息：</span>
            <textarea placeholder="商品介绍信息" class="textarea explain" style="width:500px;height:60px;"></textarea>
           </li>
           <li>
            <span class="item_name" style="width:120px;">口感：</span>
            <input type="text" class="textbox textbox_295 texture" value="樱花、芝士、抹茶、草莓" />
           </li>
           <li>
            <span class="item_name" style="width:120px;">商品类别：</span>
            <select class="select type">
               <option>naked</option>
               <option>quartet</option>
               <option>hh</option>
               <option>love</option>
               <option>kids</option>
               <option>naked</option>
               <option>cookies</option>
               <option>new-</option>
               <option>mousse</option>
               <option>cream</option>
               <option>cheese</option>
               <option>mille</option>
               <option>chocolate</option>
               <option>cup</option>
            </select>
            <li>
            <span class="item_name" style="width:120px;">价格：</span>
            <input type="text" class="textbox textbox_295 price" value="188.00" />
           </li>
           <li>
              <span class="item_name" style="width:120px;">酒精：</span>
              <select class="select alcohol">
               <option>0</option>
               <option>1</option>
              </select>
            </li>
           <li>
              <span class="item_name" style="width:120px;">适合场景：</span>
              <input type="text" class="textbox textbox_295 scene" value="各种派对、生日、纪念日、下午茶" />
            </li>
            <li>
              <span class="item_name" style="width:120px;">甜度：</span>
              <select class="select sweetness">
               <option>2</option>
               <option>1</option>
               <option>3</option>
               <option>4</option>
               <option>5</option>
               <option>0</option>
              </select>
            </li>
            <li>
              <span class="item_name" style="width:120px;">适合人群：</span>
              <input type="text" class="textbox textbox_295 suitable" value="各种人群"/>
            </li>
            <li>
              <span class="item_name" style="width:120px;">保鲜：</span>
              <input type="text" class="textbox textbox_295 fresh" value="0－4℃保藏12小时，11℃最佳食用" />
            </li>
            <li>
              <span class="item_name" style="width:120px;">原材料：</span>
              <input type="text" class="textbox textbox_295 material" placeholder="原材料"/>
            </li>
            <li>
              <span class="item_name" style="width:120px;">商品规格一：</span>
              <input type="text" class="textbox textbox_295  norms1" value="1.2磅:约13×13(cm) 454g ¥188.00" />
            </li>
            <li>
              <span class="item_name" style="width:120px;">商品规格二：</span>
              <input type="text" class="textbox textbox_295  norms2" value="2.2磅:约17×17(cm) 908g ¥298.00" />
            </li>
            <li>
              <span class="item_name" style="width:120px;">商品规格三：</span>
              <input type="text" class="textbox textbox_295  norms3" value="3.0磅:约23×23(cm)1362g ¥398.00" />
            </li>
            <li>
              <span class="item_name" style="width:120px;">商品规格四：</span>
              <input type="text" class="textbox textbox_295 norms4" value="5.0磅:约28×28(cm)2200g ¥598.00" />
            </li>
            
           <li class="clearfix">
           <form action="">
             <span class="item_name" style="width:120px;">上传图片：</span>
            <label class="input_img">
             <input type="file" name="photos"/><br>
             <input type="file" name="photos"/><br>
             <input type="file" name="photos"/><br>
             <input type="file" name="photos"/><br>
             <input type="file" name="photos"/><br>
             <!-- <span class="uploadImg"> -->
             <span><input type="button" class="submit_img" name="" value="上传图片"></span>                 
            </label>
           </form>  
           </li>
           <li>
            <span class="item_name link_tip_l" style="width:120px;"></span>
            <input type="submit" class="link_btn"/>
            <span class="link_tip" style="color:#dbac72;"></span>
           </li>
          </ul>
        </section>
    </div>
    <div class="goodsbox">
      <section class="modifyprodut" >
        <h2><strong style="color:grey;">商品添加内容布局</strong><button class="close_modify">x</button></h2>
        <ul class="ulColumn2">
         <li>
          <span class="item_name " style="width:120px;">商品名称：</span>
          <input type="text" class="textbox textbox_295 produt_name" placeholder="商品名称"/>
         </li>
         <li>
          <span class="item_name" style="width:120px;">商品ID：</span>
          <input type="text" class="textbox textbox_295 produt_id" placeholder="商品ID"/><span class="id_title" style="color:#dbac72;"></span>
          <!-- <span class="errorTips">错误提示信息...</span> -->
         </li>
         <li>
          <span class="item_name" style="width:120px;">Drand：</span>
          <input type="text" class="textbox textbox_295 produt_brand" placeholder="商品英文名"/>
         </li>
         <li>
          <span class="item_name" style="width:120px;">商品信息：</span>
          <textarea placeholder="商品介绍信息" class="textarea explain" style="width:500px;height:60px;"></textarea>
         </li>
         <li>
          <span class="item_name" style="width:120px;">口感：</span>
          <input type="text" class="textbox textbox_295 texture" value="樱花、芝士、抹茶、草莓" />
         </li>
         <li>
          <span class="item_name" style="width:120px;">商品类别：</span>
          <select class="select type">
             <option>naked</option>
             <option>quartet</option>
             <option>hh</option>
             <option>love</option>
             <option>kids</option>
             <option>naked</option>
             <option>cookies</option>
             <option>new-</option>
             <option>mousse</option>
             <option>cream</option>
             <option>cheese</option>
             <option>mille</option>
             <option>chocolate</option>
             <option>cup</option>
          </select>
          <li>
          <span class="item_name" style="width:120px;">价格：</span>
          <input type="text" class="textbox textbox_295 price" value="188.00" />
         </li>
         <li>
            <span class="item_name" style="width:120px;">酒精：</span>
            <select class="select alcohol">
             <option>0</option>
             <option>1</option>
            </select>
          </li>
         <li>
            <span class="item_name" style="width:120px;">适合场景：</span>
            <input type="text" class="textbox textbox_295 scene" value="各种派对、生日、纪念日、下午茶" />
          </li>
          <li>
            <span class="item_name" style="width:120px;">甜度：</span>
            <select class="select sweetness">
             <option>2</option>
             <option>1</option>
             <option>3</option>
             <option>4</option>
             <option>5</option>
             <option>0</option>
            </select>
          </li>
          <li>
            <span class="item_name" style="width:120px;">适合人群：</span>
            <input type="text" class="textbox textbox_295 suitable" value="各种人群"/>
          </li>
          <li>
            <span class="item_name" style="width:120px;">保鲜：</span>
            <input type="text" class="textbox textbox_295 fresh" value="0－4℃保藏12小时，11℃最佳食用" />
          </li>
          <li>
            <span class="item_name" style="width:120px;">原材料：</span>
            <input type="text" class="textbox textbox_295 material" placeholder="原材料"/>
          </li>
          <li>
            <span class="item_name" style="width:120px;">商品规格一：</span>
            <input type="text" class="textbox textbox_295  norms1" value="1.2磅:约13×13(cm) 454g ¥188.00" />
          </li>
          <li>
            <span class="item_name" style="width:120px;">商品规格二：</span>
            <input type="text" class="textbox textbox_295  norms2" value="2.2磅:约17×17(cm) 908g ¥298.00" />
          </li>
          <li>
            <span class="item_name" style="width:120px;">商品规格三：</span>
            <input type="text" class="textbox textbox_295  norms3" value="3.0磅:约23×23(cm)1362g ¥398.00" />
          </li>
          <li>
            <span class="item_name" style="width:120px;">商品规格四：</span>
            <input type="text" class="textbox textbox_295 norms4" value="5.0磅:约28×28(cm)2200g ¥598.00" />
          </li>
          
         <li class="clearfix">
         <form action="">
           <span class="item_name" style="width:120px;">上传图片：</span>
          <label class="input_img">
           <input type="file" name="photos"/><br>
           <input type="file" name="photos"/><br>
           <input type="file" name="photos"/><br>
           <input type="file" name="photos"/><br>
           <input type="file" name="photos"/><br>
           <!-- <span class="uploadImg"> -->
           <span><input type="button" class="submit_img" name="" value="上传图片"></span>                 
          </label>
         </form>  
         </li>
         <li>
          <span class="item_name link_tip_l" style="width:120px;"></span>
          <input type="submit" class="link_btn"/>
          <span class="link_tip" style="color:#dbac72;"></span>
         </li>
        </ul>
      </section>
      <table>
        <thead>
          <tr>
            <th>商品ID</th>
            <th>图片(展示)</th>
            <th>商品名</th>
            <th>价格</th>
            <th>状态</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>            
        </tbody>
      </table>       
    </div>
  </section>
  <!-- section 订单列表 -->
  <section class="order_box" style="display: none;">
    <div class="contop">
      <h4>订单查询/添加</h4>
      <div class="searchbox">
        <p class="tip">输入订单ID查询</p><span><input type="text" class="see_id"></span> <button class="search_btn">点击搜索</button>
        <span class="search_err" style="color:#dbac72;"></span>
      </div>
      <!-- <div class="contop_r">
        <button class="add_btn">添加商品</button>
      </div> -->
    </div>
    <div class="order_outbox">
      <table>
        <thead>
          <tr>
            <th>订单ID</th>
            <th>下单用户</th>
            <th>下单商品</th>
            <th>地址</th>
            <th>下单时间</th>
            <th>备注</th>
            <th>数量</th>
            <th>总价</th>
            <th>状态</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>            
        </tbody>
      </table>       
    </div>
  </section>  

  <script>
    $(function(){
      var imgarr = ['hot11.jpg'];//添加商品 图片路径接收变量

      // 上传图片
      $('.submit_img').click(function(){
        imgarr =null;
        $('form').ajaxSubmit({
          type: 'post',
          url: erp.baseUrl + 'upload',
          success:function(data){
            imgarr=data.data;
            $('.link_tip').html(data.message);
          },
          error:function(XmlHttpRequest,textStatus,errorThrown){
              console.log(XmlHttpRequest);
              console.log(textStatus);
              console.log(errorThrown);
          }
        })    
      })

      // 添加商品
      $('.link_btn').click(function(){
        var _imgarr = JSON.stringify(imgarr);
        var _norms = JSON.stringify([$('.norms1').val(),$('.norms2').val(),$('.norms3').val(),$('.norms4').val()]);
        $.post(erp.baseUrl +  'saveProdut', {
             'type':$('.type').val(),
             'id':String($('.produt_id').val()),
             'name':$('.produt_name').val(),
             'brand':$('.produt_brand').val(),
             'price':$('.price').val(),
             "images":_imgarr,
             'explain':$('.explain').val(),
             'texture':$('.texture').val(),
             'alcohol':String($('.alcohol').val()),
             'scene':$('.scene').val(),
             'sweetness':String($('.sweetness').val()),
             'suitable':$('.suitable').val(),
             'fresh':$('.fresh').val(),
             'material':$('.material').val(),
             "norms":_norms,
             'hot':0,
             'rehot':0
          }, function(response){
          if(response.status){
            console.log(response);
              $('.link_tip').html(response.message);
            } else {
              $('.link_tip').html(response.message);
            }
        })
      });

       // 输入id查询
      $('.search_btn').click(function(){
         $.post(erp.baseUrl +  'getProdut', {
         'id':String($('.see_id').val())
          }, function(response){
          if(response.status){
            var html = '';
            $('tbody').html();
              console.log(response);
              setTbody(response);
             $('.search_err').text(response.message);
            } else {
              $('.search_err').text(response.message);
            }
        })
      }); 
      // 回车id查询
      $('.see_id').keyup(function(e){
        console.log(e.keyCode)
        if (e.keyCode==13) {
          $.post(erp.baseUrl +  'getProdut', {
           'id':String($('.see_id').val())
            }, function(response){
            if(response.status){
              var html = '';
              $('tbody').html();
                console.log(response);
                setTbody(response);
               $('.search_err').text(response.message);
              } else {
                $('.search_err').text(response.message);
              }
          })
        } 
      });

      // 输入id查询是否存在
      $('.produt_id').blur(function(){
         $.post(erp.baseUrl +  'getProdut_id', {
         'id':String($('.produt_id').val())
          }, function(response){
          if(response.status){
            console.log(response);
              $('.id_title').text(response.message);
            } else {
              $('.id_title').text(response.message);
            }
        })
      });

      $('.close_add').click(function(){
        $('.addprodut').hide();
      });

       $('.add_btn').click(function(){
        $('.addprodut').show();
      });

        $('.modify_btn').click(function(){
          $('.modifyprodut').show();
        });

       $('.close_modify').click(function(){
          $('.modifyprodut').hide();
        });

       // 自添加所有商品
      $.post(erp.baseUrl +  'Produt', {
       'getprodut':'allprodut'
      }, function(response){
        if(response.status){
          setTbody(response);  
          } else {
            alert(response.message);
          }
        });

      // 商品写入tbody
      function setTbody(response){
        var html = '';
        html = response.data.map(function(item){
          return `<tr><td>${item.id}</td>
                  <td><img src="../src/img/${item.images[0]}"></td>
                  <td>${item.name}</td><td>￥${item.price}</td>
                  <td><a href="#">在售</a><br><a href="#">暂停销售</a></td>
                  <td><a href="javascript:;" class="modify_btn">修改</a><td></tr>`;
          }).join('');
          $('.box tbody').html(html);
      }

       // 自添加所有订单
      $.post(erp.baseUrl +  'order', {
       'getorder':'allorder'
      }, function(response){
        if(response.status){
          console.log(response);
          setOrderTbody(response);  
          } else {
            alert(response.message);
          }
        });

      // 订单写入tbody
      function setOrderTbody(response){
        var html = '';
        html = response.data.map(function(item){
          var orState = '';
          var goodsNameStr = '';
          var orderGoodsNum = 0;
          if (item.paid=='y') {
            orState = '已付款';
          }else if (item.shipped=='y') {
            orState = '已发货';
          }else if (item.completed=='y') {
            orState = '已完成';
          }
          goodsNameStr += item.goods.map(function(arritem){
            orderGoodsNum +=Number(arritem.num) ;
            return arritem.goodsname;
          }).join(',');
          return `<tr><td>${item.orderID}</td>
                  <td>${item.username}</td>
                  <td>${goodsNameStr}</td>
                  <td>${item.addr[0].address}</td>
                  <td>${item.orderTime}</td>
                  <td>${item.less}</td>
                  <td>${orderGoodsNum}</td>
                  <td>￥${item.totalprice}</td>
                  <td>${orState }</td>
                  <td><a href="#">查看详细信息</a></td></tr>`;
          }).join('');
          $('.order_outbox tbody').html(html);
      }

    })
  </script>

</body>
</html>
